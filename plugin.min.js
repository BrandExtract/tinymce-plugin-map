!function(e){"use strict";function t(e,t){var a,i,n=[];for(a in t)i=t[a],i&&n.push(a+"="+i);return e+=n.join("&")}function a(e){for(var t=a.options,i=t.parser[t.strictMode?"strict":"loose"].exec(e),n={},r=14;r--;)n[t.key[r]]=i[r]||"";return n[t.q.name]={},n[t.key[12]].replace(t.q.parser,function(e,a,i){a&&(n[t.q.name][a]=i)}),n}function i(e,a){var i=r[e.service||"google_staticmap"];if(!i)return"";var n=i.type;delete e.service;var o=e.width,s=e.height;e.size=o+"x"+s,e.scale&&(e.scale=2),e.markers&&(e.markers="color:blue|"+e.center);var l=e.center||e.q;"iframe"===n&&(e.q=e.center,delete e.center,delete e.markers,delete e.width,delete e.height,delete e.size,delete e.scale,delete e.format),e.key||(e.key=i.key||"");var p=t(i.api,e);return p="<"+n+' src="'+p+'"',p+=' width="'+o+'" height="'+s+'"',"img"===n&&(p+=' alt="Map of '+l+'" title="'+l+'"'),a&&(p+=' style="width: '+o+"px; height: "+s+'px;"'),p+=" />"}function n(e,t){this.editor=e,this.url=t,r.forEach(function(t){var a=r[t];a.key=e.settings[t+"_api_key"]||""});var a=this.render.bind(this);this.generalItems=[{type:"listbox",name:"service",label:"Map service",ariaLabel:"Map service",tooltip:"Available: Google.",maxLength:4,size:2,values:r.map(function(e){return{text:r[e].name,value:e}}),onselect:a},{type:"textbox",name:"key",label:"API Key",required:!0,onchange:a},{type:"textbox",name:"center",label:"Location",tooltip:'This parameter takes a location as either a comma-separated {latitude,longitude} pair (e.g. "40.714728,-73.998672") or a string address (e.g. "city hall, new york, ny") identifying a unique location on the face of the earth',required:!0,onchange:a},{type:"container",layout:"flex",direction:"row",align:"center",spacing:20,label:"Zoom",items:[{type:"listbox",subtype:"number",name:"zoom",label:"Zoom level",ariaLabel:"Zoom",tooltip:"This parameter takes a numerical value corresponding to the zoom level of the region desired",required:!0,maxLength:4,size:2,min:10,max:20,values:[10,11,12,13,14,15,16,17,18,19,20].map(function(e){return{text:e,value:e+""}}),onselect:a},{name:"markers",type:"checkbox",text:"Marker",required:!0,ariaLabel:"Marker",onchange:a}]},{type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",subtype:"number",maxLength:5,size:3,min:200,max:640,required:!0,ariaLabel:"Width",onchange:a},{type:"label",text:"x"},{name:"height",type:"textbox",subtype:"number",maxLength:5,size:3,min:200,max:640,required:!0,ariaLabel:"Height",onchange:a},{name:"scale",type:"checkbox",text:"Retina (2x)",required:!0,ariaLabel:"Retina",onchange:a}]},{type:"listbox",name:"maptype",label:"Map type",ariaLabel:"Map type",tooltip:"The map type to display. Default to roadmap.",maxLength:4,size:2,values:["roadmap","satellite"].map(function(e){return{text:e,value:e}}),onselect:a},{type:"textbox",name:"style",label:"Style",ariaLabel:"Style",tooltip:"Custom style to alter the presentation of a specific feature (roads, parks, and other features) of the map",multiline:!0,rows:3,onchange:a},{type:"listbox",name:"format",label:"Format",ariaLabel:"Image Format",tooltip:"JPEG typically provides greater compression, while GIF and PNG provide greater detail.",maxLength:4,size:2,values:["png8","png32","gif","jpg","jpg-baseline"].map(function(e){return{text:e,value:e}}),onselect:a}],this.showDialog=this.showDialog.bind(this),this.init(e,t)}e.PluginManager.requireLangPack("map");var r=["google_staticmap","google_embed"];r.google_staticmap={name:"Google Static Map",api:"//maps.googleapis.com/maps/api/staticmap?",type:"img"},r.google_embed={name:"Google Embed Map",api:"//www.google.com/maps/embed/v1/place?",type:"iframe"},a.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n.prototype.init=function(e,t){var a=this,n=r.map(function(e){var t=r[e],a=t.type+'[src*="'+t.api+'"]';return"iframe"===t.type&&(a+=',[data-mce-p-src*="'+t.api+'"]'),a}).join(",");e.addButton("map",{image:t+"/img/icons/map.svg",tooltip:"Insert/edit map",stateSelector:n,onclick:a.showDialog,onpostrender:function(){e.on("NodeChange",function(e){})}}),e.addCommand("beInsertMap",function(t,a,n){e.insertContent(i(n))}),e.addMenuItem("map",{image:t+"/img/icons/map.svg",text:"Map",onclick:a.showDialog,context:"insert"})},n.prototype.showDialog=function(){var e,t=this.editor,i=t.dom,n=this.data={};if(e=t.selection.getNode()){var o=i.getAttrib(e,"src");o||(o=i.getAttrib(e,"data-mce-p-src"));var s=a(o);s.queryKey&&(n=this.data=s.queryKey),n.center||(n.center=n.q||""),n.service="google_staticmap",r.forEach(function(e){var t=r[e];o.indexOf(t.api)>-1&&(n.service=e)}),n.width=i.getAttrib(e,"width"),n.height=i.getAttrib(e,"height")}n.width||(n.width=400),n.height||(n.height=300),this.window=null,this.window=this.editor.windowManager.open({title:"Insert a map",data:n,body:[{type:"container",layout:"grid",columns:2,spacing:20,alignH:["left","right"],items:[{type:"form",padding:0,items:this.generalItems},{type:"container",name:"map",html:""}]}],onsubmit:this.onsubmit.bind(this)}),this.render()},n.prototype.onsubmit=function(t){var a=t.data;a=e.extend(a,{}),this.editor.insertContent(i(a))},n.prototype.render=function(e){var t=this.data||{},a=i(t,!0),n=this.window;if(n){n.find("*").each(function(e){t[e.name()]=e.value()}),this.data=t,a=i(t,!0);var r=n.find("#map")[0];r.innerHtml(a).updateLayoutRect(),r.parentsAndSelf().each(function(e){e.reflow()})}return a},e.create("tinymce.plugins.Map",{init:function(e,t){return new n(e,t)},getInfo:function(){return{longname:"Map - Fully customizable map for your content.",author:"BrandExtract",authorurl:"http://www.brandextract.com",version:"0.3.0"}}}),e.PluginManager.add("map",e.plugins.Map)}(window.tinymce);
//# sourceMappingURL=plugin.js.map